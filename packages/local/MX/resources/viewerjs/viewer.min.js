/*!
 * Viewer.js v1.0.0
 * https://github.com/fengyuanchen/viewerjs
 *
 * Copyright (c) 2015-2018 Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2018-05-09T06:09:22.503Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Viewer=e()}(this,function(){"use strict";var n={inline:!1,button:!0,navbar:!0,title:!0,toolbar:!0,tooltip:!0,movable:!0,zoomable:!0,rotatable:!0,scalable:!0,transition:!0,fullscreen:!0,interval:5e3,keyboard:!0,backdrop:!0,loading:!0,loop:!0,minWidth:200,minHeight:100,zoomRatio:.1,minZoomRatio:.01,maxZoomRatio:100,zIndex:2015,zIndexInline:0,url:"src",container:"body",filter:null,ready:null,show:null,shown:null,hide:null,hidden:null,view:null,viewed:null},o="undefined"!=typeof window,s=o?window:{},w="viewer",l="move",c="switch",u="zoom",g=w+"-active",p=w+"-fade",y=w+"-fixed",r=w+"-fullscreen-exit",b=w+"-hide",e=w+"-hide-md-down",i=w+"-hide-sm-down",a=w+"-hide-xs-down",d=w+"-in",E=w+"-invisible",R=w+"-loading",h=w+"-open",f=w+"-show",v=w+"-transition",x="ready",m="show",A="shown",D="hide",I="hidden",S="view",F="viewed",T="click",L="dragstart",O="keydown",M="load",z=s.PointerEvent?"pointerdown":"touchstart mousedown",k=s.PointerEvent?"pointermove":"touchmove mousemove",C=s.PointerEvent?"pointerup pointercancel":"touchend touchcancel mouseup",P="resize",N="transitionend",U="wheel mousewheel DOMMouseScroll",Y=w+"Action",q=["download","zoom-in","zoom-out","one-to-one","reset","prev","play","next","rotate-left","rotate-right","flip-horizontal","flip-vertical"],X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),H=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)};function W(t){return"string"==typeof t}var B=Number.isNaN||s.isNaN;function _(t){return"number"==typeof t&&!B(t)}function V(t){return void 0===t}function G(t){return"object"===(void 0===t?"undefined":X(t))&&null!==t}var Q=Object.prototype.hasOwnProperty;function K(t){if(!G(t))return!1;try{var e=t.constructor,i=e.prototype;return e&&i&&Q.call(i,"isPrototypeOf")}catch(t){return!1}}function Z(t){return"function"==typeof t}function J(e,i){if(e&&Z(i))if(Array.isArray(e)||_(e.length)){var t=e.length,n=void 0;for(n=0;n<t&&!1!==i.call(e,e[n],n,e);n+=1);}else G(e)&&Object.keys(e).forEach(function(t){i.call(e,e[t],t,e)});return e}var $=Object.assign||function(i){for(var t=arguments.length,e=Array(1<t?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return G(i)&&0<e.length&&e.forEach(function(e){G(e)&&Object.keys(e).forEach(function(t){i[t]=e[t]})}),i},tt=/^(?:width|height|left|top|marginLeft|marginTop)$/;function et(t,e){var i=t.style;J(e,function(t,e){tt.test(e)&&_(t)&&(t+="px"),i[e]=t})}function it(t,e){return t.classList?t.classList.contains(e):-1<t.className.indexOf(e)}function nt(t,e){if(e)if(_(t.length))J(t,function(t){nt(t,e)});else if(t.classList)t.classList.add(e);else{var i=t.className.trim();i?i.indexOf(e)<0&&(t.className=i+" "+e):t.className=e}}function ot(t,e){e&&(_(t.length)?J(t,function(t){ot(t,e)}):t.classList?t.classList.remove(e):0<=t.className.indexOf(e)&&(t.className=t.className.replace(e,"")))}function st(t,e,i){e&&(_(t.length)?J(t,function(t){st(t,e,i)}):i?nt(t,e):ot(t,e))}var rt=/([a-z\d])([A-Z])/g;function at(t){return t.replace(rt,"$1-$2").toLowerCase()}function ht(t,e){return G(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-"+at(e))}function lt(t,e,i){G(i)?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-"+at(e),i)}var ct=/\s\s*/,ut=function(){var t=!1;if(o){var e=!1,i=function(){},n=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(t){e=t}});s.addEventListener("test",i,n),s.removeEventListener("test",i,n)}return t}();function dt(i,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},s=n;t.trim().split(ct).forEach(function(t){if(!ut){var e=i.listeners;e&&e[t]&&e[t][n]&&(s=e[t][n],delete e[t][n],0===Object.keys(e[t]).length&&delete e[t],0===Object.keys(e).length&&delete i.listeners)}i.removeEventListener(t,s,o)})}function ft(s,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},h=r;t.trim().split(ct).forEach(function(n){if(a.once&&!ut){var t=s.listeners,o=void 0===t?{}:t;h=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];delete o[n][r],s.removeEventListener(n,h,a),r.apply(s,e)},o[n]||(o[n]={}),o[n][r]&&s.removeEventListener(n,o[n][r],a),o[n][r]=h,s.listeners=o}s.addEventListener(n,h,a)})}function vt(t,e,i){var n=void 0;return Z(Event)&&Z(CustomEvent)?n=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,i),t.dispatchEvent(n)}function mt(t){var e=t.rotate,i=t.scaleX,n=t.scaleY,o=t.translateX,s=t.translateY,r=[];_(o)&&0!==o&&r.push("translateX("+o+"px)"),_(s)&&0!==s&&r.push("translateY("+s+"px)"),_(e)&&0!==e&&r.push("rotate("+e+"deg)"),_(i)&&1!==i&&r.push("scaleX("+i+")"),_(n)&&1!==n&&r.push("scaleY("+n+")");var a=r.length?r.join(" "):"none";return{WebkitTransform:a,msTransform:a,transform:a}}var gt=s.navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(s.navigator.userAgent);function wt(t,e){var i=document.createElement("img");if(t.naturalWidth&&!gt)return e(t.naturalWidth,t.naturalHeight),i;var n=document.body||document.documentElement;return i.onload=function(){e(i.width,i.height),gt||n.removeChild(i)},i.src=t.src,gt||(i.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",n.appendChild(i)),i}function pt(t){switch(t){case 2:return a;case 3:return i;case 4:return e;default:return""}}function yt(t,e){var i=t.pageX,n=t.pageY,o={endX:i,endY:n};return e?o:$({startX:i,startY:n},o)}var bt={render:function(){this.initContainer(),this.initViewer(),this.initList(),this.renderViewer()},initContainer:function(){this.containerData={width:window.innerWidth,height:window.innerHeight}},initViewer:function(){var t=this.options,e=this.parent,i=void 0;t.inline&&(i={width:Math.max(e.offsetWidth,t.minWidth),height:Math.max(e.offsetHeight,t.minHeight)},this.parentData=i),!this.fulled&&i||(i=this.containerData),this.viewerData=$({},i)},renderViewer:function(){this.options.inline&&!this.fulled&&et(this.viewer,this.viewerData)},initList:function(){var r=this,t=this.element,a=this.options,e=this.list,h=[];J(this.images,function(t,e){var i,n=t.src,o=t.alt||(W(i=n)?i.replace(/^.*\//,"").replace(/[?&#].*$/,""):""),s=a.url;W(s)?s=t.getAttribute(s):Z(s)&&(s=s.call(r,t)),(n||s)&&h.push('<li><img src="'+(n||s)+'" role="button" data-viewer-action="view" data-index="'+e+'" data-original-url="'+(s||n)+'" alt="'+o+'"></li>')}),e.innerHTML=h.join(""),this.items=e.getElementsByTagName("li"),J(this.items,function(e){var t=e.firstElementChild;lt(t,"filled",!0),a.loading&&nt(e,R),ft(t,M,function(t){a.loading&&ot(e,R),r.loadImage(t)},{once:!0})}),a.transition&&ft(t,F,function(){nt(e,v)},{once:!0})},renderList:function(t){var e=t||this.index,i=this.items[e].offsetWidth||30,n=i+1;et(this.list,$({width:n*this.length},mt({translateX:(this.viewerData.width-i)/2-n*e})))},resetList:function(){var t=this.list;t.innerHTML="",ot(t,v),et(t,mt({translateX:0}))},initImage:function(a){var h=this,l=this.options,t=this.image,e=this.viewerData,i=this.footer.offsetHeight,c=e.width,u=Math.max(e.height-i,i),d=this.imageData||{},n=void 0;this.imageInitializing={abort:function(){n.onload=null}},n=wt(t,function(t,e){var i=t/e,n=c,o=u;h.imageInitializing=!1,c<u*i?o=c/i:n=u*i;var s={naturalWidth:t,naturalHeight:e,aspectRatio:i,ratio:(n=Math.min(.9*n,t))/t,width:n,height:o=Math.min(.9*o,e),left:(c-n)/2,top:(u-o)/2},r=$({},s);l.rotatable&&(s.rotate=d.rotate||0,r.rotate=0),l.scalable&&(s.scaleX=d.scaleX||1,s.scaleY=d.scaleY||1,r.scaleX=1,r.scaleY=1),h.imageData=s,h.initialImageData=r,a&&a()})},renderImage:function(t){var e=this,i=this.image,n=this.imageData;if(et(i,$({width:n.width,height:n.height,marginLeft:n.left,marginTop:n.top},mt(n))),t)if(this.viewing&&this.options.transition){var o=function(){e.imageRendering=!1,t()};this.imageRendering={abort:function(){dt(i,N,o)}},ft(i,N,o,{once:!0})}else t()},resetImage:function(){if(this.viewing||this.viewed){var t=this.image;this.viewing&&this.viewing.abort(),t.parentNode.removeChild(t),this.image=null}}},Et={bind:function(){var t=this.element,e=this.viewer;ft(e,T,this.onClick=this.click.bind(this)),ft(e,U,this.onWheel=this.wheel.bind(this)),ft(e,L,this.onDragStart=this.dragstart.bind(this)),ft(this.canvas,z,this.onPointerDown=this.pointerdown.bind(this)),ft(t.ownerDocument,k,this.onPointerMove=this.pointermove.bind(this)),ft(t.ownerDocument,C,this.onPointerUp=this.pointerup.bind(this)),ft(t.ownerDocument,O,this.onKeyDown=this.keydown.bind(this)),ft(window,P,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.viewer;dt(e,T,this.onClick),dt(e,U,this.onWheel),dt(e,L,this.onDragStart),dt(this.canvas,z,this.onPointerDown),dt(t.ownerDocument,k,this.onPointerMove),dt(t.ownerDocument,C,this.onPointerUp),dt(t.ownerDocument,O,this.onKeyDown),dt(window,P,this.onResize)}},Rt={click:function(t){var e=t.target,i=this.options,n=this.imageData;switch(ht(e,Y)){case"download":this.download(this.image.getAttribute("src"));break;case"mix":this.played?this.stop():i.inline?this.fulled?this.exit():this.full():this.hide();break;case"hide":this.hide();break;case"view":this.view(ht(e,"index"));break;case"zoom-in":this.zoom(.1,!0);break;case"zoom-out":this.zoom(-.1,!0);break;case"one-to-one":this.toggle();break;case"reset":this.reset();break;case"prev":this.prev(i.loop);break;case"play":this.play(i.fullscreen);break;case"next":this.next(i.loop);break;case"rotate-left":this.rotate(-90);break;case"rotate-right":this.rotate(90);break;case"flip-horizontal":this.scaleX(-n.scaleX||-1);break;case"flip-vertical":this.scaleY(-n.scaleY||-1);break;default:this.played&&this.stop()}},load:function(){var t=this;this.timeout&&(clearTimeout(this.timeout),this.timeout=!1);var e=this.element,i=this.options,n=this.image,o=this.index,s=this.viewerData;ot(n,E),i.loading&&ot(this.canvas,R),n.style.cssText="height:0;margin-left:"+s.width/2+"px;margin-top:"+s.height/2+"px;max-width:none!important;position:absolute;width:0;",this.initImage(function(){st(n,"viewer-move",i.movable),st(n,v,i.transition),t.renderImage(function(){t.viewed=!0,t.viewing=!1,Z(i.viewed)&&ft(e,F,i.viewed,{once:!0}),vt(e,F,{originalImage:t.images[o],index:o,image:n})})})},loadImage:function(t){var s=t.target,e=s.parentNode,r=e.offsetWidth||30,a=e.offsetHeight||50,h=!!ht(s,"filled");wt(s,function(t,e){var i=t/e,n=r,o=a;r<a*i?h?n=a*i:o=r/i:h?o=r/i:n=a*i,et(s,$({width:n,height:o},mt({translateX:(r-n)/2,translateY:(a-o)/2})))})},keydown:function(t){var e=this.options;if(this.fulled&&e.keyboard)switch(t.keyCode||t.which||t.charCode){case 27:this.played?this.stop():e.inline?this.fulled&&this.exit():this.hide();break;case 32:this.played&&this.stop();break;case 37:this.prev(e.loop);break;case 38:t.preventDefault(),this.zoom(e.zoomRatio,!0);break;case 39:this.next(e.loop);break;case 40:t.preventDefault(),this.zoom(-e.zoomRatio,!0);break;case 48:case 49:t.ctrlKey&&(t.preventDefault(),this.toggle())}},dragstart:function(t){"img"===t.target.tagName.toLowerCase()&&t.preventDefault()},pointerdown:function(t){var e=this.options,i=this.pointers;if(this.viewed&&!this.showing&&!this.viewing&&!this.hiding){t.changedTouches?J(t.changedTouches,function(t){i[t.identifier]=yt(t)}):i[t.pointerId||0]=yt(t);var n=!!e.movable&&l;1<Object.keys(i).length?n=u:"touch"!==t.pointerType&&"touchstart"!==t.type||!this.isSwitchable()||(n=c),this.action=n}},pointermove:function(t){var e=this.options,i=this.pointers,n=this.action,o=this.image;this.viewed&&n&&(t.preventDefault(),t.changedTouches?J(t.changedTouches,function(t){$(i[t.identifier],yt(t,!0))}):$(i[t.pointerId||0],yt(t,!0)),n===l&&e.transition&&it(o,v)&&ot(o,v),this.change(t))},pointerup:function(t){var e=this.action,i=this.pointers;t.changedTouches?J(t.changedTouches,function(t){delete i[t.identifier]}):delete i[t.pointerId||0],e&&(e===l&&this.options.transition&&nt(this.image,v),this.action=!1)},resize:function(){var e=this;if(this.isShown&&!this.hiding&&(this.initContainer(),this.initViewer(),this.renderViewer(),this.renderList(),this.viewed&&this.initImage(function(){e.renderImage()}),this.played)){if(this.options.fullscreen&&this.fulled&&!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement)return void this.stop();J(this.player.getElementsByTagName("img"),function(t){ft(t,M,e.loadImage.bind(e),{once:!0}),vt(t,M)})}},wheel:function(t){var e=this;if(this.viewed&&(t.preventDefault(),!this.wheeling)){this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50);var i=Number(this.options.zoomRatio)||.1,n=1;t.deltaY?n=0<t.deltaY?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=0<t.detail?1:-1),this.zoom(-n*i,!0,t)}}},xt=0,At={isIOS:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),emptyFn:function(){},getDom:function(t){return"string"==typeof t?document.getElementById(t):t},id:function(t,e){if(t&&t.id)return t.id;var i=(e||"ext-")+(xt+=1);return t&&(t.id=i),i},isEmpty:function(t,e){return null==t||!e&&""===t||this.isArray(t)&&0===t.length},isArray:"isArray"in Array?Array.isArray:function(t){return"[object Array]"===toString.call(t)},isFunction:"undefined"!=typeof document&&"function"==typeof document.getElementsByTagName("body")?function(t){return!!t&&"[object Function]"===toString.call(t)}:function(t){return!!t&&"function"==typeof t}},Dt={isFileUri:function(t){return!At.isEmpty(t)&&"file://"===t.substr(0,7).toLowerCase()},splitPath:function(t){var e="",i="",n=t.lastIndexOf("/");return-1===n?i=t:(e=t.substr(0,n),i=t.substr(n+1)),0<=(n=i.indexOf("?"))&&(i=i.substr(0,n)),[e,this.stripIllegalChars(i)]},getFileName:function(t){return t?this.splitPath(t)[1]:""},getFileNameWoExt:function(t){if(!t)return"";var e=this.splitPath(t),i=e[1].lastIndexOf(".");return i<0?e[1]:e[1].substr(0,i)},getExtension:function(t,e){if(!t)return"";var i=this.splitPath(t),n=i[1].lastIndexOf(".");if(n<0)return"";var o=i[1].substr(n+1);return e?o.toLowerCase():o},stripIllegalChars:function(t){return At.isEmpty(t)?t:t.replace(/[\\\\/:*?"<>|]/g,"_")}};void 0===window.LocalFileSystem&&void 0!==window.PERSISTENT&&(window.LocalFileSystem={PERSISTENT:window.PERSISTENT,TEMPORARY:window.TEMPORARY}),window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.resolveLocalFileSystemURL=window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL;var It={FILEERROR:{1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR",1000:"UNKNOWN_ERR"},parse:function(t,e){var i=null,n=null;null==t&&(t=1);var o=window.cordova?cordova.file.tempDirectory:null,s=(window.cordova||window.cefMain).file.dataDirectory;return Dt.isFileUri(e)?(n=e,o&&0===e.indexOf(o)?(t=0,i=decodeURIComponent(e.substr(o.length))):0===e.indexOf(s)?(t=1,i=decodeURIComponent(e.substr(s.length))):console.error("暂不支持的路径")):(i=e,0===t&&o?n=o+e:1===t?n=s+e:console.error("暂不支持的路径")),{root:t,relative:i,full:n}},load0:function(){var n=this;return new Promise(function(e,i){return n.tmpFileSystem?e(n.tmpFileSystem):window.requestFileSystem?void window.resolveLocalFileSystemURL(cordova.file.tempDirectory,function(t){n.tmpFileSystem=t.filesystem,e(n.tmpFileSystem)},function(t){console.error("FileSystem","load0 failed",t,n.FILEERROR[t.code]),i(t)}):i(new Error("不支持 requestFileSystem"))})},load1:function(){var n=this;return new Promise(function(e,i){return n.fileSystem?e(n.fileSystem):window.requestFileSystem?void window.resolveLocalFileSystemURL((window.cordova||window.cefMain).file.dataDirectory,function(t){n.fileSystem=t.filesystem,e(n.fileSystem)},function(t){console.error("FileSystem","load1 failed",t,n.FILEERROR[t.code]),i(t)}):i(new Error("不支持 requestFileSystem"))})}},St={queues0:{},queues1:{},create_r:function(t,e,i,n,o){o=void 0===o?0:o;var s,r=this,a=e.split("/"),h=o+1,l=a.slice(0,h).join("/");h===a.length||/\/$/.test(l)?r.create_one(t,l,i,n):r.create_one(t,l,(s=[t,e,i,n,h],function(){r.create_r.apply(r,H(s))}),n)},create_one:function(t,e,i,n){It["load"+t]().then(function(t){t.root.getDirectory(e,{create:!0,exclusive:!1},function(t){i&&i(t)},function(t){console.error("DirMgr","create directory failed",It.FILEERROR[t.code]),n&&n(t)})}).catch(n)},create:function(h,l){var c=this;return new Promise(function(t,e){var i=It.parse(h,l),n=i.relative,o="queues"+i.root,s=c[o][n];if(!s){s=[],c[o][n]=s;var r=function(t){var e=c[o][n];if(e){for(;e.length;){var i=e.shift();i.resolve&&i.resolve(t)}delete c[o][n]}},a=function(t){var e=c[o][n];if(e){for(;e.length;){var i=e.shift();i.reject&&i.reject(t)}delete c[o][n]}};It["load"+i.root]().then(function(t){t.root.getDirectory(n,{create:!1},r,function(t){1===t.code?c.create_r(i.root,n,r,a):a(t)})}).catch(a)}s.push({resolve:t,reject:e})})},moveTo:function(i,n,o,s){var r=this;return new Promise(function(t,e){r.copyOrMove(i,n,o,s,2,!0,t,e)})},copyTo:function(i,n,o,s){var r=this;return new Promise(function(t,e){r.copyOrMove(i,n,o,s,2,!1,t,e)})},copyOrMove:function(e,o,t,i,s,r,a,n){if(!At.isEmpty(o)&&!At.isEmpty(i)){var h=this;a=At.isFunction(a)?a:At.emptyFn;var l=function(t){console.error("DirMgr","copyOrMove failed",t.code?h.FILEERROR[t.code]:t),At.isFunction(n)&&n(t)},c=h.parse(t,i).relative,u=Dt.splitPath(c),d=u[0],f=u[1];h.create(t,d).then(function(i){if(Dt.isFileUri(o))window.resolveLocalFileSystemURL(o,function(t){t[r?"moveTo":"copyTo"](i,f,function(t){a(t.toURL())},l)},l);else{var t=h.parse(e,o),n=t.relative;h["load"+t.root]().then(function(t){var e="";1===s?e="getFile":2===s&&(e="getDirectory"),e?t.root[e](n,{create:!1},function(t){t[r?"moveTo":"copyTo"](i,f,function(t){a(t.toURL())},l)},l):l("unknown exception")}).catch(l)}}).catch(l)}},remove:function(o,s){return new Promise(function(e,i){var t=It.parse(o,s),n=t.relative;It["load"+t.root]().then(function(t){t.root.getDirectory(n,{create:!1},function(t){t.removeRecursively(e,i)},function(t){1!==t.code&&i(t)})}).catch(i)})}},Ft={downFile:function(v,m,g,w){var p=this;return new Promise(function(t,e){var i=!(!w||!w.force),n=It.parse(m,g),o=n.relative,s=Dt.splitPath(o),r=s[0],a=s[1],h="queues"+n.root,l=o,c=p[h][l];if(!c){c=[],p[h][l]=c;var u=function(t){console.log("file download succeed",t);var e=p[h][l];if(e){for(;e.length;){var i=e.shift();i.resolve&&i.resolve(t.toURL())}delete p[h][l]}},d=function(t){console.log("file download failed",t);var e=p[h][l];if(e){for(;e.length;){var i=e.shift();i.reject&&i.reject(t)}delete p[h][l]}},f=function(t){var e=new FileTransfer;e.onprogress=function(t){if(t.lengthComputable){var e=(t.loaded/(100*t.total)).toFixed(2),i=p[h][l];i&&i.length&&i.forEach(function(t){t.downloading&&t.downloading(e)})}},e.download(v,t,u,d)};St.create(n.root,r).then(function(t){var e=t.toURL()+encodeURIComponent(a);i?f(e):t.getFile(a,{create:!1},function(t){console.log("file found",t),u(t)},function(t){1===t.code?
// 否则就到网络下载文件!
f(e):d(t)})}).catch(d)}c.push({resolve:t,reject:e,downloading:w&&At.isFunction(w.downloading)?w.downloading:null})})},downFileForSrc:function(){for(var l=this,t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var c=e.url,n=e.saveRoot,o=e.savePath,u=e.options,d=It.parse(n,o);return window.cordova&&At.isIOS&&window.indexedDB&&0!==d.root?new Promise(function(t,e){var n="srcQueues"+d.root,o=d.relative,i=l[n][o];if(!i){i=[],l[n][o]=i;var s=function(t){console.log("file download succeed",t);var e=l[n][o];if(e){for(;e.length;){var i=e.shift();i.resolve&&i.resolve(t)}delete l[n][o]}},r=function(t){console.log("file download failed",t);var e=l[n][o];if(e){for(;e.length;){var i=e.shift();i.reject&&i.reject(t)}delete l[n][o]}},a=!(!u||!u.force),h=function(){l.downFile(c,d.root,d.relative,{force:a,downloading:function(e){var t=l[n][o];t&&t.length&&t.forEach(function(t){t.downloading&&t.downloading(e)})}}).then(function(t){return l.copyTo(d.root,t,0,d.relative).then(function(t){s(t)})}).catch(r)};a?h():l.exists(0,d.relative).then(function(t){if(t){var e=t.toURL();s(e),l.exists(1,d.relative).then(function(t){if(!t)return l.copyTo(0,e,d.root,d.relative)})}else h()}).catch(r)}i.push({resolve:t,reject:e,downloading:u&&At.isFunction(u.downloading)?u.downloading:null})}):l.downFile.apply(l,H(e))},remove:function(s,r){return new Promise(function(e,i){var n=function(t){console.error("FileMgr","remove failed",t.code?It.FILEERROR[t.code]:t),i(t)};if(At.isEmpty(r)&&n("路径为空"),Dt.isFileUri(r))window.resolveLocalFileSystemURL(r,function(t){t.remove(e,n)},n);else{var t=It.parse(s,r),o=t.relative;It["load"+t.root]().then(function(t){t.root.getFile(o,{create:!1,exclusive:!1},function(t){t.remove(e,n)},n)}).catch(n)}})},exists:function(s,r){return new Promise(function(e,i){var t=function(t){console.error("FileMgr","check exists failed",t.code?It.FILEERROR[t.code]:t),i(t)};At.isEmpty(r)&&t("路径为空");var n=It.parse(s,r),o=n.relative;It["load"+n.root]().then(function(t){t.root.getFile(o,{create:!1},e,function(t){1===t.code?e(null):i(t)})}).catch(t)})},moveTo:function(i,n,o,s){return new Promise(function(t,e){St.copyOrMove(i,n,o,s,1,!0,t,e)})},copyTo:function(i,n,o,s){return new Promise(function(t,e){St.copyOrMove(i,n,o,s,1,!1,t,e)})},solveDup:function(s,r,a){var h=this;return new Promise(function(n,e){var i=function(t){console.error("FileMgr","solveDup failed",t.code?It.FILEERROR[t.code]:t),e(t)};if(Dt.isFileUri(r))window.resolveLocalFileSystemURL(r,function(t){var e=Dt.getFileNameWoExt(a),i=Dt.getExtension(a);h.solveDupInner(t,e,i,0,n)},i);else{var t=It.parse(s,r),o=t.relative;It["load"+t.root]().then(function(t){t.root.getDirectory(o,{create:!1},function(t){var e=Dt.getFileNameWoExt(a),i=Dt.getExtension(a);h.solveDupInner(t,e,i,0,n)},i)}).catch(i)}})},open:function(n){return new Promise(function(t,e){var i=n;window.FileEntry&&n instanceof window.FileEntry&&(i=n.toURL()),i=decodeURIComponent(i),window.plugins&&plugins.fileOpener?plugins.fileOpener.open(i,t,function(t){e(t),alert(t.message||"")}):window.cefMain&&cefMain.open(i,t,function(t){e(t),alert(t.message||"")})})},queues0:{},queues1:{},srcQueues0:{},srcQueues1:{},solveDupInner:function(t,e,i,n,o){var s=this,r=e+(0===n?".":" ("+n+").")+i;t.getFile(r,{create:!1},function(){s.solveDupInner(t,e,i,n+1,o)},function(){o(r)})}},Tt={show:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.element,i=this.options;if(i.inline||this.showing||this.isShown||this.showing)return this;if(!this.ready)return this.build(),this.ready&&this.show(t),this;if(Z(i.show)&&ft(e,m,i.show,{once:!0}),!1===vt(e,m)||!this.ready)return this;this.hiding&&this.transitioning.abort(),this.showing=!0,this.open();var n=this.viewer;if(ot(n,b),i.transition&&!t){var o=this.shown.bind(this);this.transitioning={abort:function(){dt(n,N,o),ot(n,d)}},nt(n,v),n.offsetWidth,ft(n,N,o,{once:!0}),nt(n,d)}else nt(n,d),this.shown();return this},hide:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.element,i=this.options;if(i.inline||this.hiding||!this.isShown&&!this.showing)return this;if(Z(i.hide)&&ft(e,D,i.hide,{once:!0}),!1===vt(e,D))return this;this.showing&&this.transitioning.abort(),this.hiding=!0,this.played?this.stop():this.viewing&&this.viewing.abort();var n=this.viewer;if(i.transition&&!t){var o=this.hidden.bind(this),s=function(){ft(n,N,o,{once:!0}),ot(n,d)};this.transitioning={abort:function(){this.viewed?dt(this.image,N,s):dt(n,N,o)}},this.viewed?(ft(this.image,N,s,{once:!0}),this.zoomTo(0,!1,!1,!0)):s()}else ot(n,d),this.hidden();return this},view:function(){var i=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(t=Number(t)||0,!this.isShown)return this.index=t,this.show();if(this.hiding||this.played||t<0||t>=this.length||this.viewed&&t===this.index)return this;this.viewing&&this.viewing.abort();var e=this.element,n=this.options,o=this.title,s=this.canvas,r=this.items[t],a=r.querySelector("img"),h=ht(a,"originalUrl"),l=a.getAttribute("alt"),c=document.createElement("img");if((window.cordova||window.cefMain)&&/https?:\/\//i.test(h)){var u=At.id(c),d=Dt.getFileName(h),f=n.saveDir;At.isEmpty(f)||"/"===f.charAt(f.length-1)||(f+="/"),Ft.downFileForSrc(h,1,""+f+d,{}).then(function(t){var e=At.getDom(u);e&&e===i.image&&(i.viewing.abort(),e.src=t)}).catch(function(t){console.log(t);var e=At.getDom(u);e&&e===i.image&&(i.viewing.abort(),e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAAwCAMAAACR11I4AAAAhFBMVEUAAACww9jj7fjA0OEAAAADAwP3+vwEBAQAAAALCwvExsgICAgKCgrMz9P6+vrIy8+ipah5eXnn5+f39/jt7e3P1Nq6vL/z8/P8/Py/zNr////Y4u3I2er7/P3q8fjG3PTu8/jC2fHn7vbw9fq70enp8PbK3/bt8vjP4/i91e/T5vvR5fr6AzUjAAAAGnRSTlMA/fj9Aiv9BhMMYyIahulBIEaN2LGqeMru1WReUU4AAAJ4SURBVHhepdbrkqMgEIDRIAyIRnMzyU4D3nObff/32243biYRXVPz/ZuC02TUslz8PKE89UuTiY6vdjDouKY1lcFUuxVt0ql3jQaoMIGpUo0+BGgGOUhXaiH08uDANSMBhF5PIYvwIuhl9AsHvO9rE8gtDlDLTQruXX/iDOOZFkKFmx249/yF8RvG2G5NAz6OAG953t66WktXUek4A5ATvnyJE6Y4yIhuQ7wHcOVrY/7U9r51AEk3IHHg5vqm6n1VOoDs74MgQc70pem9wWEA2+5BSIwb9/4fUHU8W6JXEWNmri8vRYUVZSkB9jE9BQd2q/hs38g8CHJJT3HS8QR51ZoRfxmEE5qmdCCjJfE9qyj+vGnCU8jTTfe/fyKn2tMbvnGw24TI9Sev7pn5vgE4Ehdr1hZ9fK4nnsXEV8T72mCmv9834rfiW9br8+8ZxqwEdyCuIlYV3+On/JHX18wW3Hb3bSESVpyfKsz/PCfRso3GJYV/vMR9/vTI2A5YthLot8Grt/Vjr8/zfh/HAUIPB5hJb6rrvYJHqhtwfY5P+Zo/Np554htQmQlvz09H7X0D7NDX9wI8fjggCZ593TfwyJ/jn3ow4GzGvLHX1yxfi9cBdszT8f4BUTDDm/NvT2e+6gY8Fq7G7zkC74DoZYD1++uXvyunl1AUfPUZv89HfLBFL9b8n8/9vnGDAODXMaI3MH1k9QvlwPuTALtNrNVCqK0Dl9d9s3zjQCYfoRJCrI8AksR8n0uAbLPU9PqnT6hLPepT8JYeYjwcL1wGY6XkdeQdsMfDBX2dpuM80uhVGH94outG6SUu+4vDbovSvpQgTavjIf9pfwA8bC3+UnIYZgAAAABJRU5ErkJggg==")})}else c.src=h;if(c.alt=l,Z(n.view)&&ft(e,S,n.view,{once:!0}),!1===vt(e,S,{originalImage:this.images[t],index:t,image:c})||!this.isShown||this.hiding||this.played)return this;this.image=c,ot(this.items[this.index],g),nt(r,g),this.viewed=!1,this.index=t,this.imageData={},nt(c,E),n.loading&&nt(s,R),s.innerHTML="",s.appendChild(c),this.renderList(),o.innerHTML="";var v=function(){var t=i.imageData;o.textContent=l+" ("+t.naturalWidth+" × "+t.naturalHeight+")"},m=void 0;return ft(e,F,v,{once:!0}),this.viewing={abort:function(){dt(e,F,v),c.complete?this.imageRendering?this.imageRendering.abort():this.imageInitializing&&this.imageInitializing.abort():(dt(c,M,m),this.timeout&&clearTimeout(this.timeout))}},c.complete?this.load():(ft(c,M,m=this.load.bind(this),{once:!0}),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){ot(c,E),i.timeout=!1},1e3)),this},prev:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.index-1;return e<0&&(e=t?this.length-1:0),this.view(e),this},next:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.length-1,i=this.index+1;return e<i&&(i=t?0:e),this.view(i),this},move:function(t,e){var i=this.imageData;return this.moveTo(V(t)?t:i.left+Number(t),V(e)?e:i.top+Number(e)),this},moveTo:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t,i=this.imageData;if(t=Number(t),e=Number(e),this.viewed&&!this.played&&this.options.movable){var n=!1;_(t)&&(i.left=t,n=!0),_(e)&&(i.top=e,n=!0),n&&this.renderImage()}return this},zoom:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=this.imageData;return t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(n.width*t/n.naturalWidth,e,i),this},zoomTo:function(t){var n,o,s,e,i,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,h=3<arguments.length&&void 0!==arguments[3]&&arguments[3],l=this.options,c=this.pointers,u=this.imageData;if(_(t=Math.max(0,t))&&this.viewed&&!this.played&&(h||l.zoomable)){if(!h){var d=Math.max(.01,l.minZoomRatio),f=Math.min(100,l.maxZoomRatio);t=Math.min(Math.max(t,d),f)}a&&.95<t&&t<1.05&&(t=1);var v=u.naturalWidth*t,m=u.naturalHeight*t;if(a){var g=(e=this.viewer,{left:(i=e.getBoundingClientRect()).left+(window.pageXOffset-document.documentElement.clientLeft),top:i.top+(window.pageYOffset-document.documentElement.clientTop)}),w=c&&Object.keys(c).length?(s=o=n=0,J(c,function(t){var e=t.startX,i=t.startY;n+=e,o+=i,s+=1}),{pageX:n/=s,pageY:o/=s}):{pageX:a.pageX,pageY:a.pageY};u.left-=(v-u.width)*((w.pageX-g.left-u.left)/u.width),u.top-=(m-u.height)*((w.pageY-g.top-u.top)/u.height)}else u.left-=(v-u.width)/2,u.top-=(m-u.height)/2;u.width=v,u.height=m,u.ratio=t,this.renderImage(),r&&this.tooltip()}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t)),this},rotateTo:function(t){var e=this.imageData;return _(t=Number(t))&&this.viewed&&!this.played&&this.options.rotatable&&(e.rotate=t,this.renderImage()),this},scaleX:function(t){return this.scale(t,this.imageData.scaleY),this},scaleY:function(t){return this.scale(this.imageData.scaleX,t),this},scale:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t,i=this.imageData;if(t=Number(t),e=Number(e),this.viewed&&!this.played&&this.options.scalable){var n=!1;_(t)&&(i.scaleX=t,n=!0),_(e)&&(i.scaleY=e,n=!0),n&&this.renderImage()}return this},play:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(!this.isShown||this.played)return this;var o=this.options,s=this.player,r=this.loadImage.bind(this),a=[],h=0,l=0;if(this.played=!0,this.onLoadWhenPlay=r,t&&this.requestFullscreen(),nt(s,f),J(this.items,function(t,e){var i=t.querySelector("img"),n=document.createElement("img");n.src=ht(i,"originalUrl"),n.alt=i.getAttribute("alt"),h+=1,nt(n,p),st(n,v,o.transition),it(t,g)&&(nt(n,d),l=e),a.push(n),ft(n,M,r,{once:!0}),s.appendChild(n)}),_(o.interval)&&0<o.interval){var i=function t(){e.playing=setTimeout(function(){ot(a[l],d),nt(a[l=(l+=1)<h?l:0],d),t()},o.interval)};1<h&&i()}return this},stop:function(){var e=this;if(!this.played)return this;var t=this.player;return this.played=!1,clearTimeout(this.playing),J(t.getElementsByTagName("img"),function(t){dt(t,M,e.onLoadWhenPlay)}),ot(t,f),t.innerHTML="",this.exitFullscreen(),this},full:function(){var t=this,e=this.options,i=this.viewer,n=this.image,o=this.list;return!this.isShown||this.played||this.fulled||!e.inline||(this.fulled=!0,this.open(),nt(this.button,r),e.transition&&(ot(o,v),this.viewed&&ot(n,v)),nt(i,y),i.setAttribute("style",""),et(i,{zIndex:e.zIndex}),this.initContainer(),this.viewerData=$({},this.containerData),this.renderList(),this.viewed&&this.initImage(function(){t.renderImage(function(){e.transition&&setTimeout(function(){nt(n,v),nt(o,v)},0)})})),this},download:function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download","");var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!0,!1,0,null),e.dispatchEvent(i)},exit:function(){var t=this,e=this.options,i=this.viewer,n=this.image,o=this.list;return this.isShown&&!this.played&&this.fulled&&e.inline&&(this.fulled=!1,this.close(),ot(this.button,r),e.transition&&(ot(o,v),this.viewed&&ot(n,v)),ot(i,y),et(i,{zIndex:e.zIndexInline}),this.viewerData=$({},this.parentData),this.renderViewer(),this.renderList(),this.viewed&&this.initImage(function(){t.renderImage(function(){e.transition&&setTimeout(function(){nt(n,v),nt(o,v)},0)})})),this},tooltip:function(){var t=this,e=this.options,i=this.tooltipBox,n=this.imageData;return this.viewed&&!this.played&&e.tooltip&&(i.textContent=Math.round(100*n.ratio)+"%",this.tooltipping?clearTimeout(this.tooltipping):e.transition?(this.fading&&vt(i,N),nt(i,f),nt(i,p),nt(i,v),i.offsetWidth,nt(i,d)):nt(i,f),this.tooltipping=setTimeout(function(){e.transition?(ft(i,N,function(){ot(i,f),ot(i,p),ot(i,v),t.fading=!1},{once:!0}),ot(i,d),t.fading=!0):ot(i,f),t.tooltipping=!1},1e3)),this},toggle:function(){return 1===this.imageData.ratio?this.zoomTo(this.initialImageData.ratio,!0):this.zoomTo(1,!0),this},reset:function(){return this.viewed&&!this.played&&(this.imageData=$({},this.initialImageData),this.renderImage()),this},update:function(){var t=this.element,e=this.options,i=this.isImg;if(i&&!t.parentNode)return this.destroy();var o=[];if(J(i?[t]:t.querySelectorAll("img"),function(t){e.filter?e.filter(t)&&o.push(t):o.push(t)}),!o.length)return this;if(this.images=o,this.length=o.length,this.ready){var s=[];if(J(this.items,function(t,e){var i=t.querySelector("img"),n=o[e];n?n.src!==i.src&&s.push(e):s.push(e)}),et(this.list,{width:"auto"}),this.initList(),this.isShown)if(this.length){if(this.viewed){var n=s.indexOf(this.index);0<=n?(this.viewed=!1,this.view(Math.max(this.index-(n+1),0))):nt(this.items[this.index],g)}}else this.image=null,this.viewed=!1,this.index=0,this.imageData={},this.canvas.innerHTML="",this.title.innerHTML=""}else this.build();return this},destroy:function(){var t=this.element,e=this.options;return ht(t,w)&&(this.destroyed=!0,this.ready?(this.played&&this.stop(),e.inline?(this.fulled&&this.exit(),this.unbind()):this.isShown?(this.viewing&&(this.imageRendering?this.imageRendering.abort():this.imageInitializing&&this.imageInitializing.abort()),this.hiding&&this.transitioning.abort(),this.hidden()):this.showing&&(this.transitioning.abort(),this.hidden()),this.ready=!1,this.viewer.parentNode.removeChild(this.viewer)):e.inline&&(this.delaying?this.delaying.abort():this.initializing&&this.initializing.abort()),e.inline||dt(t,T,this.onStart),function(e,i){if(G(e[i]))try{delete e[i]}catch(t){e[i]=void 0}else if(e.dataset)try{delete e.dataset[i]}catch(t){e.dataset[i]=void 0}else e.removeAttribute("data-"+at(i))}(t,w)),this}},Lt={open:function(){var t=this.body;nt(t,h),t.style.paddingRight=this.scrollbarWidth+(parseFloat(this.initialBodyPaddingRight)||0)+"px"},close:function(){var t=this.body;ot(t,h),t.style.paddingRight=this.initialBodyPaddingRight},shown:function(){var t=this.element,e=this.options;this.fulled=!0,this.isShown=!0,this.render(),this.bind(),this.showing=!1,Z(e.shown)&&ft(t,A,e.shown,{once:!0}),!1!==vt(t,A)&&this.ready&&this.isShown&&!this.hiding&&this.view(this.index)},hidden:function(){var t=this.element,e=this.options;this.fulled=!1,this.viewed=!1,this.isShown=!1,this.close(),this.unbind(),nt(this.viewer,b),this.resetList(),this.resetImage(),this.hiding=!1,this.destroyed||(Z(e.hidden)&&ft(t,I,e.hidden,{once:!0}),vt(t,I))},requestFullscreen:function(){var t=this.element.ownerDocument;if(this.fulled&&!t.fullscreenElement&&!t.mozFullScreenElement&&!t.webkitFullscreenElement&&!t.msFullscreenElement){var e=t.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}},exitFullscreen:function(){if(this.fulled){var t=this.element.ownerDocument;t.exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()}},change:function(t){var e,i,h,n=this.options,o=this.pointers,s=o[Object.keys(o)[0]],r=s.endX-s.startX,a=s.endY-s.startY;switch(this.action){case l:this.move(r,a);break;case u:this.zoom((i=$({},e=o),h=[],J(e,function(a,t){delete i[t],J(i,function(t){var e=Math.abs(a.startX-t.startX),i=Math.abs(a.startY-t.startY),n=Math.abs(a.endX-t.endX),o=Math.abs(a.endY-t.endY),s=Math.sqrt(e*e+i*i),r=(Math.sqrt(n*n+o*o)-s)/s;h.push(r)})}),h.sort(function(t,e){return Math.abs(t)<Math.abs(e)}),h[0]),!1,t);break;case c:this.action="switched",this.pointers={},Math.abs(r)>Math.abs(a)&&(1<r?this.prev(n.loop):r<-1&&this.next(n.loop))}J(o,function(t){t.startX=t.endX,t.startY=t.endY})},isSwitchable:function(){var t=this.imageData,e=this.viewerData;return 1<this.length&&0<=t.left&&0<=t.top&&t.width<=e.width&&t.height<=e.height}},Ot=s.Viewer,Mt=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(j(this,i),!t||1!==t.nodeType)throw new Error("The first argument is required and must be an element.");this.element=t,this.options=$({},n,K(e)&&e),this.action=!1,this.fading=!1,this.fulled=!1,this.hiding=!1,this.imageData={},this.index=0,this.isImg=!1,this.isShown=!1,this.length=0,this.played=!1,this.playing=!1,this.pointers={},this.ready=!1,this.showing=!1,this.timeout=!1,this.tooltipping=!1,this.viewed=!1,this.viewing=!1,this.wheeling=!1,this.init()}return t(i,[{key:"init",value:function(){var i=this,t=this.element,e=this.options;if(!ht(t,w)){lt(t,w,this);var n="img"===t.tagName.toLowerCase(),o=[];if(J(n?[t]:t.querySelectorAll("img"),function(t){Z(e.filter)?e.filter.call(i,t)&&o.push(t):o.push(t)}),o.length){this.isImg=n,this.length=o.length,this.images=o;var s=t.ownerDocument,r=s.body||s.documentElement;if(this.body=r,this.scrollbarWidth=window.innerWidth-s.documentElement.clientWidth,this.initialBodyPaddingRight=window.getComputedStyle(r).paddingRight,V(document.createElement(w).style.transition)&&(e.transition=!1),e.inline){var a=0,h=function(){if((a+=1)===i.length){var t=void 0;i.initializing=!1,i.delaying={abort:function(){clearTimeout(t)}},t=setTimeout(function(){i.delaying=!1,i.build()},0)}};this.initializing={abort:function(){J(o,function(t){t.complete||dt(t,M,h)})}},J(o,function(t){t.complete?h():ft(t,M,h,{once:!0})})}else ft(t,T,this.onStart=function(t){var e=t.target;"img"===e.tagName.toLowerCase()&&i.view(i.images.indexOf(e))})}}}},{key:"build",value:function(){if(!this.ready){var t=this.element,h=this.options,e=t.parentNode,i=document.createElement("div");i.innerHTML='<div class="viewer-container" touch-action="none"><div class="viewer-canvas"></div><div class="viewer-footer"><div class="viewer-title"></div><div class="viewer-toolbar"></div><div class="viewer-navbar"><ul class="viewer-list"></ul></div></div><div class="viewer-tooltip"></div><div role="button" class="viewer-button" data-viewer-action="mix"></div><div role="button" class="viewer-left viewer-prev" data-viewer-action="prev"></div><div role="button" class="viewer-right viewer-next" data-viewer-action="next"></div><div class="viewer-player"></div></div>';var n=i.querySelector("."+w+"-container"),o=n.querySelector("."+w+"-title"),s=n.querySelector("."+w+"-toolbar"),r=n.querySelector("."+w+"-navbar"),a=n.querySelector("."+w+"-button"),l=n.querySelector("."+w+"-canvas");if(this.parent=e,this.viewer=n,this.title=o,this.toolbar=s,this.navbar=r,this.button=a,this.canvas=l,this.footer=n.querySelector("."+w+"-footer"),this.tooltipBox=n.querySelector("."+w+"-tooltip"),this.player=n.querySelector("."+w+"-player"),this.list=n.querySelector("."+w+"-list"),nt(o,h.title?pt(h.title):b),nt(r,h.navbar?pt(h.navbar):b),st(a,b,!h.button),h.backdrop&&(nt(n,w+"-backdrop"),h.inline||!0!==h.backdrop||lt(l,Y,"hide")),h.toolbar){var c=document.createElement("ul"),u=K(h.toolbar),d=q.slice(0,3),f=q.slice(7,9),v=q.slice(9);u||nt(s,pt(h.toolbar)),J(u?h.toolbar:q,function(t,e){var i=u&&K(t),n=u?at(e):t,o=i&&!V(t.show)?t.show:t;if(o&&(h.zoomable||-1===d.indexOf(n))&&(h.rotatable||-1===f.indexOf(n))&&(h.scalable||-1===v.indexOf(n))){var s=i&&!V(t.size)?t.size:t,r=i&&!V(t.click)?t.click:t,a=document.createElement("li");a.setAttribute("role","button"),nt(a,w+"-"+n),Z(r)||lt(a,Y,n),_(o)&&nt(a,pt(o)),-1!==["small","large"].indexOf(s)?nt(a,w+"-"+s):"play"===n&&nt(a,w+"-large"),Z(r)&&ft(a,T,r),c.appendChild(a)}}),s.appendChild(c)}else nt(s,b);if(!h.rotatable){var m=s.querySelectorAll('li[class*="rotate"]');nt(m,E),J(m,function(t){s.appendChild(t)})}if(h.inline)nt(a,"viewer-fullscreen"),et(n,{zIndex:h.zIndexInline}),"static"===window.getComputedStyle(e).position&&et(e,{position:"relative"}),e.insertBefore(n,t.nextSibling);else{nt(a,"viewer-close"),nt(n,y),nt(n,p),nt(n,b),et(n,{zIndex:h.zIndex});var g=h.container;W(g)&&(g=t.ownerDocument.querySelector(g)),g||(g=this.body),g.appendChild(n)}h.inline&&(this.render(),this.bind(),this.isShown=!0),this.ready=!0,Z(h.ready)&&ft(t,x,h.ready,{once:!0}),!1!==vt(t,x)?this.ready&&h.inline&&this.view():this.ready=!1}}}],[{key:"noConflict",value:function(){return window.Viewer=Ot,i}},{key:"setDefaults",value:function(t){$(n,K(t)&&t)}}]),i}();return $(Mt.prototype,bt,Et,Rt,Tt,Lt),Mt});